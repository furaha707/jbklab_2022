<?
require_once($_SERVER[DOCUMENT_ROOT]."/INC/header.php");
$ARR_BOARD_TYPE[1] = "영업팀";
$ARR_BOARD_TYPE[2] = "기획팀";
$ARR_BOARD_TYPE[3] = "디자인팀";
$ARR_BOARD_TYPE[4] = "퍼블팀";
$ARR_BOARD_TYPE[5] = "개발팀";

$query1 = "select complete from tb_checklist where optionType='9'" ;
$complete =  $db->select_one( $query1 );
$disabled = "";
if($complete=="Y"){
	$disabled = "disabled";
	$query1 = "select uname from tb_checklist where optionType='9'" ;
	$lastuname =  $db->select_one( $query1 );
}

?>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">


  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name='format-detection' content='telephone=no, address=no, email=no'>
  
 <link href="../css/sub.css" rel="stylesheet">
 <link rel="stylesheet" href="../sadmin/css/basic.css" rel="stylesheet">
 <link rel="stylesheet" href="../sadmin/css/common.css" rel="stylesheet">
 <link rel="stylesheet" href="../sadmin/css/style.css" rel="stylesheet">

<title>오픈전 체크리스트</title>

 <link rel="stylesheet" href="../sadmin/css/basic.css" rel="stylesheet">
 <link rel="stylesheet" href="../sadmin/css/common.css" rel="stylesheet">
 <link rel="stylesheet" href="../sadmin/css/others.css" rel="stylesheet">
 <link rel="stylesheet" href="//cdn.jsdelivr.net/xeicon/2.2.0/xeicon.min.css">
<script type="text/javascript" src="/js/head_1.js"></script>
<style>
@media all and (max-width:1400px) {
.table-form-list {
margin-top:-30px;
}
.table-form-list > .item {
margin-top:30px;
}
.table-form-list > .item {
flex:1 0 33%;
max-width: 33%;
}
}
@media all and (max-width:1024px) {
.table-form-list {
margin-top:-30px;
}
.table-form-list > .item {
margin-top:30px;
}
.table-form-list > .item {
flex:1 0 50%;
max-width: 50%;
}
}
@media all and (max-width:700px) {
.table-form-list {
margin-top:-30px;
}
.table-form-list > .item {
margin-top:30px;
}
.table-form-list > .item {
flex:1 0 100%;
max-width: 100%;
}
}

.home { overflow-x:hidden; }
#section { max-width: none; }
.sub_wrap { margin-left: 0; }
.sub_wrap .sub_con { padding: 20px; }
</style>
</head>
<body style="overflow-x: hidden;">
<div class="home">




  <div id="section" class="clearfix">
    <div class="sub_wrap">
      <div class="sub_con main_con board_con">
        <div class="sub_tit">
          <h2>오픈전 체크리스트  <?if($complete!="Y"){?><input type="text" value="" placeholder="검수자 이름" class="qcname"><?}?></h2>
        </div>



<form name="qcform" method="post" id="qcform" action="checklist_proc.php" onsubmit="return CheckFormSubmit();">
<input type="hidden" name="mode" value="complete">
<input type="hidden" name="indexurl" value="">
<input type="hidden" name="uname" value="">


  <!-- S : 상품 분류 목록 -->
  <ul class="table-form-list">
    
	
	<? for($i=1;$i<=count($ARR_BOARD_TYPE);$i++) { ?>
    <li class="item optionType-<?=$i?>">      
      <h3 class="table-form-list-title"><?=$ARR_BOARD_TYPE[$i]?></h3> <!-- 상품 분류명 -->
      
      
      <!-- S : 스크롤 박스 영역 -->
      <div class="table-form-scroll">
        <div class="scroll-inner">
          <!-- S : 상품 분류별 아이템 목록 -->
          <ul class="prd-info-list">
            
            <? 

		$query = "select * from tb_checklist where optionType='".$i."' order by sortnum asc";
		//echo "$query /<br>";
		$result = $db->fetch_array( $query );
		$rcount = count($result) ;
		for ( $j=0 ; $j<$rcount ; $j++ ) {
			$list = $result[$j];
			?>
            <li class="item list-item">
			    <input <?=$disabled?> type="checkbox" value="Y" name="complete" class="prd-info-checkbox"  data-uid="<?=$list['uid']?>" <?=($list['complete']=="Y")?"checked":"";?> required>&nbsp;&nbsp;
              <div class="prd-info-name" data-uid="<?=$list['uid']?>" data-dis="<?=$disabled?>">
                <span class="text"><?=$list['optionName']?><?if($list['uname'] and $list['complete']=="Y"){?><span class="complete_uname">-<?=$list['uname']?></span><?}?></span> <!-- 상품 아이템명 -->
                <input type="text" name="" id="" value="<?=$list['optionName']?>" class="prd-info-input"> <!-- 상품 입력값 -->
              </div>
              <div class="prd-info-control">
                <button type="button" class="prd-info-button" data-uid="<?=$list['uid']?>" data-dis="<?=$disabled?>"><i class="xi-trash-o"></i></button>
              </div>
            </li>
            <?}?>
            
          </ul>
          <!-- E : 상품 분류별 아이템 목록 -->
        </div>
      </div>
      <!-- E : 스크롤 박스 영역 -->
      
      <?if($complete!="Y"){?>
      <!-- S : 추가버튼 영역 -->
      <div class="form-group mt_10">
        <div class="form-group__control">
          <input type="text" name="" id="" value="" class="prd-add-input-<?=$i?>">
        </div>
        <div class="from-group__button">
          <button type="button" class="btn-type-03 prd_add" optionType="<?=$i?>">추가</button>
        </div>
      </div>
	  <?}?>
      <!-- E : 추가버튼 영역 -->
    </li>
    <?}?>
    
  </ul>
  <!-- E : 상품 분류 목록 -->

      <?if($complete!="Y"){?>
  <div class="text_center mt_50">
    <button type="submit" class="btn-type-03">index 생성</button>
  </div>
	  <?}else{?>
		  <div class="text_center mt_50">
			<button type="button" class="btn-type-02">최종검수 완료 (최종검수자 : <?=$lastuname?>)</button>
		  </div>

	  <?}?>
</form>

<script>

var nowdomain = "<?=$_SERVER['SERVER_NAME']?>";
// 추가
  $(document).on('click','.prd_add', function(){  
	var optionType = $(this).attr('optionType'),
		$thisItem = $('.optionType-'+optionType),
        $thisScroll = $thisItem.find('.scroll-inner'), /* 스크롤 영역 */
        $thisList = $thisItem.find('.prd-info-list'), /* 추가될 리스트 */
        $input = $thisItem.find('.prd-add-input-'+optionType),
        optionName = $input.val(), /* 추가될 텍스트 */
        itemHTML = '';

		if(optionName==""){
			alert('내용을 입력해주세요.');
			$('.prd-add-input-'+optionType).focus();
			return false;
		}

		$.ajax({ 
			type : "POST"
			, async : false
			, url : "checklist_proc.php"
			, dataType : "JSON"
			, data : "mode=product_option_add&optionType="+optionType+"&optionName="+optionName
			, success : function(res){
				if(res.code=="1"){
					/* HTMl 변수 */
					itemHTML += '<li class="item list-item">';
					itemHTML += '<input type="checkbox" value="Y" name="complete" class="prd-info-checkbox"  data-uid="'+res.max_uid+'" required>&nbsp;&nbsp;';
					itemHTML += '<div class="prd-info-name"  data-uid="'+res.max_uid+'">';
					itemHTML += '<span class="text">'+ optionName +'</span>';
					itemHTML += '<input type="text" name="" id="" value="'+ optionName +'" class="prd-info-input">';
					itemHTML += '</div>';
					itemHTML += '<div class="prd-info-control">';
					itemHTML += '<button type="button" class="prd-info-button"  data-uid="'+res.max_uid+'"><i class="xi-trash-o"></i></button>';
					itemHTML += '</div>';
					itemHTML += '</li>';

					$thisList.append(itemHTML); /* 리스트에 추가 */
					//$thisScroll.scrollTop($thisScroll.prop('scrollHeight')); /* 추가 후 스크롤 하단으로 이동 */
					$input.val('').focus(); /* 추가 후 해당 input에 포커스 유지 */
				}
			}
		});
  });

// 수정
  var OrgoptionName = "";

  $(document).on('click','.prd-info-name', function(){
	  if($(this).attr("data-dis")!="disabled"){
		  OrgoptionName = $(this).find('.prd-info-input').val();
		  $(this).addClass('on');
		  $(this).find('input').focus();
	  }else{
		  alert("검수 완료된 데이터는 변경이 불가합니다.");
	  }
  });


  $(document).on('focusout','.prd-info-name', function(){
	var $thisItem = $(this);
	var optionName = $thisItem.find('.prd-info-input').val();
	var uid = $thisItem.attr('data-uid');
	
	if(optionName==""){
		alert('내용을 입력해주세요.');
		$thisItem.focus();
		return false;
	}

	if(confirm('내용을 수정하시겠습니까?\n검수값은 초기화 됩니다.')){
		$.ajax({ 
			type : "POST"
			, async : false
			, url : "checklist_proc.php"
			, dataType : "JSON"
			, data : "mode=product_option_modi&optionName="+optionName+"&uid="+uid
			, success : function(res){
				if(res.code=="1"){
					$thisItem.removeClass('on');
					$thisItem.find('.text').text(optionName);
				}
			}
		});
	}else{
		$thisItem.removeClass('on');
		$thisItem.find('.text').text(OrgoptionName);		
	}
  });

// 삭제

	var msg = []; 
	msg[1] = "해당 내용에 대한 검수가 완료되었습니까?";
	msg[2] = "정말 검수 완료한것 맞습니까?";
	msg[3] = "검수 안하고 완료체크 하시는건 아니시죠?";
	msg[4] = "오픈 후 해당 이슈 발생시 검수자에게 벌점 부과합니다.";

  $(document).on('click','.prd-info-checkbox', function(){
		var complete = "N";

		var rand = Math.floor(Math.random()*(4-1+1)+1);
		var checked = $(this).is(":checked");
		var uname = $(".qcname").val();
	  	if(uname==""){
			alert("검수자 이름을 입력해주세요.");
			if(checked) $(this).prop('checked', false);
			else $(this).prop('checked', true);
			$(".qcname").focus();
			return false;
		}
		if(checked) {
			complete = "Y";
			  if(!confirm(msg[rand])){
				  return false;
			  }
		}

		var $thisItem = $(this);
		var uid = $thisItem.attr('data-uid');

		$.ajax({ 
			type : "POST"
			, async : false
			, url : "checklist_proc.php"
			, dataType : "JSON"
			, data : "mode=product_option_complete&uid="+uid+"&complete="+complete+"&uname="+uname
			, success : function(res){
				if(res.code=="1"){
					$thisItem.next().find(".text").append("<p class='complete_uname'>-"+res.uname+"</p>");
				}else{
					$thisItem.next().find(".complete_uname").remove();
				}
			}
		});
  });

  $(document).on('click','.prd-info-button', function(){  
	  if($(this).attr("data-dis")!="disabled"){
		  if(confirm('삭제 후에는 복구가 불가능합니다.\n삭제 하시겠습니까?')){
			var $thisItem = $(this);
			var uid = $thisItem.attr('data-uid');

			$.ajax({ 
				type : "POST"
				, async : false
				, url : "checklist_proc.php"
				, dataType : "JSON"
				, data : "mode=product_option_del&uid="+uid
				, success : function(res){
					if(res.code=="1"){
						$thisItem.parents('.list-item').remove();
					}
				}
			});
		  }
	  }else{
		  alert("검수 완료된 데이터는 삭제가 불가합니다.");
	  }
  });

function CheckFormSubmit(){

	var uname = $(".qcname").val();
	if(uname==""){
		alert("검수자 이름을 입력해주세요.");
		$(".qcname").focus();
		return false;
	}

	var indexurl = prompt(nowdomain+" 접속시 연결할 파일 경로를 입력해주세요.","./main/main.html");
	if(indexurl==null){
		return false;
	}else{
		if (confirm(indexurl+" 해당 경로로 index파일을 생성하시겠습니까?"))
		{
			document.qcform.indexurl.value = indexurl;
			document.qcform.uname.value = uname;			
		}else{
			return false;
		}
	}
}



/*
  $('.prd-info-list').sortable();
  $('.prd-info-list').disableSelection();
*/


</script>



      </div>
      <!-- 컨텐츠 //-->
    </div>
  </div>
  <!-- 섹션 // -->
</div>
<!--전체 // -->

	  
<SCRIPT LANGUAGE="JavaScript">
	$(document).ready(function() {
		if ( getCookie( "Pop777" ) != "Pop777" ){
			//alert("<?=$Coval?>");
			$(".Pop777").show();
		}
	});
</SCRIPT>  

  <div class="modal  fade in start_pop Pop777" id="modal777" aria-hidden="false"> 
      <div class="modal_standard">
          <div class="modal_wrap">
            <div class="modal-dialog" style="width:350px;">
              <div class="modal-content"   >
                  <!-- header -->
                  <div class="modal-header">
					<h1 style="font-size:20px;font-weight:bold;">오픈전 체크리스트</h1>
                  </div>
                  <!-- body -->
                  <div class="modal-body">
					<div class="inner"></div>					 
					  <div class="ml_10 mr_10" style="text-align:left !important;line-height:25px;">
					  	본 페이지는 <br>
						기존 유지보수 문의 내용과 <br>
						팀별 의견을 수렴하여 만든 <br>
						최종검수 페이지입니다. <br>
						체크 완료 후 <b>index 생성</b> 버튼 클릭시 <br>
						<b style="color:red">index 페이지가 생성</b>됩니다. <br>
					  </div>
                  </div>
                  <!-- Footer -->
                  <div class="modal-footer clearfix">
                 <!--  Footer
                  <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button> -->
                    <div class="check-area left" >
                      <input type="checkbox" id="Pop777" onclick="closeWin('100','Pop777');"  style="cursor:pointer">
                      <label for="Pop777" class="ml_05">오늘 열지 않기</label>
                    </div>
                      <div class="pop-close right" style="cursor:pointer" onclick="parent.modal777.style.display='none';" >닫기</div>
                  </div>

              </div>
            </div>
          </div>
      </div>
  </div>
<!-- END 팝업 ================modal -->

 

<SCRIPT LANGUAGE="JavaScript">
<!--
		function setCookie( name, value, expiredays ,val)
{
        var todayDate = new Date();
        todayDate.setDate( todayDate.getDate() + expiredays );
        document.cookie = val + '=' + escape( val ) + '; path=/; expires=' + todayDate.toGMTString() + ';'
		//alert(document.cookie);
 return;
}


function closeWin(lay,val) { 
	setCookie( lay, "done" , 1,val); 
   // alert(val);
	//document.getElementById(lay).style.display='none';
}


function getCookie( name ){
  var nameOfCookie = name + "=";
  var x = 0;
  while ( x <= document.cookie.length )
  {
    var y = (x+nameOfCookie.length);
    if ( document.cookie.substring( x, y ) == nameOfCookie ) {
      if ( (endOfCookie=document.cookie.indexOf( ";", y )) == -1 )
        endOfCookie = document.cookie.length;
      return unescape( document.cookie.substring( y, endOfCookie ) );
    }
    x = document.cookie.indexOf( " ", x ) + 1;
    if ( x == 0 )
      break;
  }
  return "";
}
//-->
</SCRIPT>

</body>