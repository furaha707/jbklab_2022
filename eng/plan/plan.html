<? include "../include/head.html" ?>
<!DOCTYPE html>
<html lang="<?=$P_lang?>">
	<head>
<?
$P_dp1 = '6';
$P_dp2 = '1';
include "../include/meta.html";

${nav_.$P_dp1._.$P_dp2}="셀메드 플랜";
?>
		<link rel="stylesheet" href="../assets/css/plan.css" />
	</head>

	<body class="sub-body plan-body">
		<? include "../include/header.html" ?>
		<? include "../include/sub-visual.html" ?>
		<? include "../include/sub-nav.html" ?>

		<main class="main sub-main" id="contents">
			<section class="section">
				<div class="container pb-30">
					<p class="sub-tit text-center pt-20 pb-10">셀메드 플랜</p>
					<div class="tab tab--product mb-20">
						<div class="tab-header">
<?
for ( $s=0 ; $s<$rcount_plan ; $s++ ) {
  $row=$result_plan[$s];
?>
							<div class="tab-item">
								<a class="link <? if ($row['cateno']==$depth) { ?>on<? } ?>" data-target="#content0<?=$s?>"><?=$row['catename']?></a>
							</div>
<?
}
?>
						</div>
					</div>



<?
for ( $s=0 ; $s<$rcount_plan ; $s++ ) {
  $row=$result_plan[$s];
?>
          <div class="plan-wrapper" id="content0<?=$s?>">
						<div class="plan-tit-bx">
							<div class="inner">
								<p class="tit"><?=stripslashes($row['catename'])?></p>
								<p class="sub-tit"><?=stripslashes(nl2br($row['description']))?></p>
							</div>
							<a href="./plan-list.html?depth=<?=$row['cateno']?>" class="link"><i class="xi-plus"></i> 더 보기</a>
						</div>

						<div class="plan-slider swiper-container">
							<div class="swiper-control mb-3">
								<button type="button" class="swiper-button swiper-button--prev">
									<i class="xi-angle-left"></i>
								</button>
								<div class="page mx-2">
									<span class="now">2</span>
									<span class="mx-0">/</span>
									<span class="total">2</span>
								</div>
								<button type="button" class="swiper-button swiper-button--next">
									<i class="xi-angle-right"></i>
								</button>
							</div>
							<div class="swiper-wrapper">
<?
  $tablefile="upload/product";

  $query_sub = "SELECT * FROM tb_product where viewtype='Y' and plan_depth1='".$row['cateno']."' and field_etc_08='Y' ".$wsql_lantype." order by uid desc";
  $result_sub = $db->fetch_array( $query_sub );
  $rcount_sub= count($result_sub);

  for ($i=0;$i<$rcount_sub;$i++) {

    $row = $result_sub[$i];
    $row['fileadd_name']=json_decode($row['fileadd_name'], true);

    if($row['fileadd_name']['name']) {
      if(file_exists(ROOT."/$tablefile/thumb/".$row['fileadd_name']['name'])){
        $row['img_view'] = "$HOME_PATH/$tablefile/thumb/".$row['fileadd_name']['name'];
      }else{
        $row['img_view'] = "$HOME_PATH/$tablefile/".$row['fileadd_name']['name'];
      }
    } else {
      $row['img_view'] = "/images/board/no_img.jpg";
      $row['noimage'] = "Y";
    }
?>

								<a href="../plan/plan-list.html?bmain=view&uid=<?=$row['uid']?>&depth=<?=$row['plan_depth1']?>" class="swiper-slide">
									<!-- 이미지 권장사이즈 670*480 -->
									<div class="img_box">
										<img src="<?=$row['img_view']?>" alt="product image" />
									</div>
									<div class="txt_box">
										<p class="tit"><?=$row['title']?></p>
										<p class="des"><?=nl2br($row['field_etc_05'])?></p>
									</div>
								</a>
<?
  }
?>
							</div>
						</div>
					</div>
<? } ?>

				</div>
			</section>
		</main>

		<? include "../include/footer.html" ?>
		<? include "../include/js.html" ?>
		<script>
			$(document).ready(function () {
				var planAddSlider = [];



				$('.plan-slider').each(function (index) {
					var $this = $(this);
					$this.addClass('plan-slider' + index);

					planAddSlider[index] = new Swiper('.plan-slider' + index, {
						loop: false,
						slidesPerView: 2,
						spaceBetween: 10,
						speed: 500,
						autoHeight: true,
						navigation: {
							nextEl: $('.plan-slider' + index).children('.swiper-button--next'),
							prevEl: $('.plan-slider' + index).children('.swiper-button--prev'),
						},
						breakpoints: {
							1024: {
								slidesPerView: 3,
								spaceBetween: 30,
							},
							1200: {
								slidesPerView: 4,
								spaceBetween: 30,
							},
						},
					});

      	var thumbslide = $('.plan-slider' + index).find('.swiper-slide').length;

		    if(thumbslide <= 0){
				$('.plan-slider' + index).find('.now').text('0');
			} else{
				$('.plan-slider' + index).find('.now').text('1');
			}


				$('.plan-slider' + index).find('.total').text(thumbslide);


					planAddSlider[index].on('slideChange', function () {
        var activeSlide = planAddSlider[index].realIndex + 1;
						$('.plan-slider' + index)
							.find('.now')
							.text(activeSlide);
					});
				});

				const headerHeight = $('.header').height() + 10;

				$('.tab-item .link').on('click', function () {
					const target = $(this).attr('data-target');
					const scrollPosition = $(target).offset().top - headerHeight;

					$('.tab-item .link').removeClass('on');
					$(this).addClass('on');
					$('html, body').stop().animate({ scrollTop: scrollPosition }, 500);
				});
			});
		</script>
	</body>
</html>
